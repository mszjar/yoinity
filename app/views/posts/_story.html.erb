<!--title-->
<h1 class="title"> <%= @post.title %></h1>
<!--post image-->
<div class="subtitle-info">
  <% if @post.photo.key.nil? %>
    <div> <%= image_tag "default_image.png", class: "avatar-post" %></div>
  <% else %>
    <div> <%= cl_image_tag @post.photo.key, class: "avatar-post" %></div>
  <% end %>
</div>
<!--like, quality, reviews buttons-->
<div class="show-icons">
  <!--author avatar-->
  <div class="show-icons-item">
    <%= link_to profile_path(@post.user.nickname) do %>
      <%= cl_image_tag @post.user.photo.key, class: "avatar-small" %>
    <% end %>
  </div>
  <p class="d-flex align-items-center" style="font-size: 16px" >By <%= @post.user.nickname %> </p>
  <div class="d-flex align-items-center" >
    <% if user_signed_in? %>
      <% user_follow = current_user.following?(User.find(@post.user_id)) %>
      <% if user_follow %>
        <p><%= button_to "Following âœ”", unfollow_follower_path(User.find(@post.user_id)), class: "btn btn-following", method: :post %></p>
      <% else %>
        <p><%= button_to "Follow", follow_follower_path(User.find(@post.user_id)), class: "btn btn-follow", method: :post %></p>
      <% end %>
    <% end %>
  </div>
  <!--icon like-->
  <div class="show-icons-item">
    <% if user_signed_in? %>
      <% post_like = current_user.post_likes.find_by(post: @post) %>
      <% if post_like.nil? %>
        <%= button_to post_likes_path, class: "btn icon-button", params: { post_like: { post_id: @post.id }}, method: :post do %>
          <i class="far fa-heart"></i>
        <% end %>
      <% else %>
        <%= button_to post_like_path(post_like), class: "btn icon-button", method: :delete do %>
          <i class="fas fa-heart" style="color: #FF3040"></i>
        <% end %>
      <% end %>
    <% end %>
    <p><%= @post.post_likes.count %></p>
  </div>
  <!--icon reviews-->
  <div class="show-icons-item">
    <% if @post.comments.count == 0 %>
      <button class="btn icon-button"><i class="far fa-comment" data-tabs-target="tab" data-action="click->tabs#changeTab" data-tabs-value="reviews"></i></button>
    <% else %>
      <button class="btn icon-button"><i class="fas fa-comment" data-tabs-target="tab" data-action="click->tabs#changeTab" data-tabs-value="reviews"></i></button>
    <% end %>
    <p><%= @post.comments.count %></p>
  </div>
  <!--icon quality-->
  <div class="show-icons-item">
    <% if user_signed_in? %>
      <% post_quality = current_user.post_qualities.find_by(post: @post) %>
      <% if post_quality.nil? %>
        <%= button_to post_qualities_path, class: "btn icon-button", params: { post_quality: { post_id: @post.id }}, method: :post do %>
          <i class="far fa-star"></i>
        <% end %>
      <% else %>
        <%= button_to post_quality_path(post_quality), class: "btn icon-button", method: :delete do %>
          <i class="fas fa-star" style="color: #FFD43B"></i>
        <% end %>
      <% end %>
    <% end %>
    <p><%= @post.post_qualities.count %></p>
  </div>
  <!--icon save for later-->
  <div class="show-icons-item show-icons-item-end">
    <% if user_signed_in? %>
      <% saved_for_later = current_user.saved_for_laters.find_by(post: @post) %>
      <% if saved_for_later.nil? %>
        <%= button_to saved_for_laters_path, class: "btn icon-button", params: { saved_for_later: { post_id: @post.id }}, method: :post do %>
          <i class="far fa-clock"></i>
        <% end %>
        <p>Save</p>
      <% else %>
        <%= button_to saved_for_later_path(saved_for_later), class: "btn icon-button", method: :delete do %>
          <i class="fas fa-clock"></i>
        <% end %>
        <p>Saved</p>
      <% end %>
    <% end %>
  </div>
</div>
<!--date & duration-->
<div class="subtitle-info">
  <div class="show-date"><%= @post.created_at.strftime("%-d %B %Y") %></div>
  <div class="show-date"><%= @post.speech_duration.round(0) %> min read</div>
</div>
<!--categories-->
<div class="category">
  <% @post.categories.each do |category| %>
    <p><%= category.name %></p>
  <% end %>
</div>
<!--listen to remixes-->
<div class="show-date">Listen to remixes</div>
<!--remixes bar-->
<div class="remixes-bar" >
  <!--amazon polly-->
  <div class="audio-player" data-controller="audio">
    <div class="custom-controls">
      <div class="play-button" data-action="click->audio#togglePlay">
        <% if @post.photo.key.nil? %>
          <div> <%= image_tag "default_image.png", class: "avatar" %></div>
        <% else %>
          <div> <%= cl_image_tag @post.photo.key, class: "avatar" %></div>
        <% end %>
      </div>
    </div>
    <audio data-audio-target="audio">
      <source src="<%= speech_post_path(@post.token) %>" type="audio/mpeg">
    </audio>
  </div>

  <!--remixes-->
  <div class="remixes" >
  <% @remixes.each do |remix| %>
  <div class="audio-player" data-controller="audio">
    <% if remix.present? && remix.audio.attached? %>
        <div data-action="click->audio#togglePlay"><%= cl_image_tag @remix.user.photo.key, class: "avatar" %></div>
        <audio data-audio-target="audio">
          <source src="<%= audio_remix_path(remix) %>" type="<%= remix.audio.blob.content_type %>">
        </audio>
    <% end %>
  </div>
  <% end %>
  </div>

  <!-- Remix button -->
<div>
  <button type="button" class="btn btn-classic" data-bs-toggle="modal" data-bs-target="#remixModal">
    Remix
  </button>
</div>

<!-- Remix form (Modal) -->
<div class="modal fade" id="remixModal" tabindex="-1" aria-labelledby="remixModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="remixModalLabel">Remix</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= simple_form_for @remix, url: remixes_path, html: { data: { controller: "recording", recording_target: "form" } } do |f| %>
          <%= f.input :post_id, as: :hidden, input_html: { value: @post.id, data: { recording_target: "post_id" } } %>
          <%= f.input :language, placeholder: "Enter language", input_html: { data: { recording_target: "language" } } %>

          <div data-action="click->recording#startRecording" data-recording-target="start">
            <%= button_tag "Start recording", type: "button" %>
          </div>
          <div data-action="click->recording#stopRecording" data-recording-target="stop">
            <%= button_tag "Stop recording", type: "button" %>
          </div>
          <div data-action= "click->recording#submitForm">
            <%= f.submit "Submit Remix" %>
          </div>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


</div>
<!--content-->
<div class="show-content">
  <p><%= @post.content.gsub(/\n/, '<br>').html_safe %></p>
</div>
